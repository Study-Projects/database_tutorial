## Глава 0. Введение

Это руководство познакомит вас с написанием и администрированием собственного интернет-блога и публикацией его в сети Интернет при помощи языка программирования Python 3 и фреймворка Django версии 1.11.

Почти каждый сайт состоит из двух половинок: дизайн и внешний вид страниц, которые видит пользователь и серверная логика, что делает сервер. Эти две части называют front-end и back-end соответственно. Это руководство больше о серверной логике, мы не ставим целью сделать дизайн красивым, но ознакомим вас с тем, как можно свободно менять его.

####  Почему Python 3?

Ну, для начала, он очень популярен. А чем популярнее язык - тем больше его коммьюнити, а чем больше коммьюнити - тем легче найти доступные статьи по интересующим вас темам, тем легче попасть в него и тем проще получить наиболее квалифицированную помощь. Также огромное общество выпустило огромное множество всяческих модулей для более комфортной работы.

Также он очень прост. Нет никаких “ритуалов” вроде точки с запятой в конце строки, для освоения, всё правда будет очень просто.

#### Почему Django?

Это самый популярный python фреймворк. Разве этого недостаточно?

При успешном выполнении всех шагов, описанных в данном руководстве, вы сможете получить что-то вроде этого:

![blog_screen](https://github.com/Study-Projects/database_tutorial/blob/master/img/blog_screen.jpg)

## Глава 1. Установка зависимостей.

Перед началом работы необходимо создать *виртуальное окружение* (другое название - virtualenv). Virtualenv будет изолировать зависимости Python/Django для каждого отдельного проекта. Это значит, что изменения одного сайта никогда не затронут другие сайты, которые вы разрабатываете. 

Для создания virtualenv в консоли (откройте раздел Поиск и введите команду `cmd`) необходимо выполнить следующие шаги: 

1. Создадим на рабочем столе папку `django_blog`: `mkdir C:\Users\USER\Desktop\django_blog`
2. И разместим в ней виртуальное окружение: `python -m venv C:\Users\USER\Desktop\django_blog\venv`
3. Теперь активируем его: `C:\Users\USER\Desktop\django_blog\venv\Scripts\activate.bat`
4. В начале строки появится приписка (venv), которая показывает, что виртуальное окружение активно. Наконец, чтобы деактивировать виртуальное окружение, достаточно написать `deactivate`.

После выпполнения всех команд можно приступить к установке Django. Для загрузки модулей в Python используется программа, которая называется pip. Для начала установки в консоли необходимо ввести команду `pip install django==1.11.0` (В процессе установки консоль может зависнуть. Если это случилось, необходимо использовать команду `python -m pip install django==1.11.0`. Прервать зависшую установку можно комбинацией клавиш `Ctrl-C`).

Также в процессе разработки нам понадобится система контроля версий - Git. Эта программа отслеживает изменения, происходящие с файлами, чтобы впоследствии можно было восстановить состояние кода на нужный момент времени. Это немного похоже на функцию отслеживания изменений в Microsoft Word, но куда мощнее.

TODO: Узнать есть ли в РЭУ гит

Скачать Git можно [здесь](https://git-scm.com/). Процесс установки может выполнятся согласно инструкции, за исключением шага №5 "Adjusting your PATH environment" (Настройка системной переменной Path). Здесь стоит выбрать "Use Git and optional Unix tools from the Windows Command Prompt" (Запуск Git и соответствующих Unix утилит через командную строку Windows, нижняя опция). Все остальные настройки можно оставить по умолчанию. Также нужно будет выбрать опцию "Checkout Windows-style, commit Unix-style line endings".

После окончания установки необходимо перезапустить командную строку.



## Глава 2. Создание проекта.

Для написания сайтов на фреймворке Django используется структура, согласно которой за каждый раздел сайта отвечает отдельный блок файлов с кодом, название которого app (приложение). Совокупность приложений образует проект. Для создания проекта необходимо запустить ряд стандартных скриптов. Для начала выполните команду `C:\Users\USER\Desktop\django_blog django-admin.exe startproject django_blog . `. Очень важно не потерять точку в конце, чтобы создать проект в текущей директории и не допустить появления лишних папок.  

`django-admin.py` — это скрипт, который создаст необходимую структуру директорий и файлы. Теперь у проекта должна быть следующая структура:

```
django_blog
├───manage.py
└───django_blog
        settings.py
        urls.py
        wsgi.py
        __init__.py
```

`manage.py` — это скрипт, который помогает с управлением сайтом. С помощью него запускается веб-сервер на компьютере без установки дополнительных программ.

Файл `settings.py` содержит настройки для веб-сайта.

Файл `urls.py` содержит список шаблонов, по которым ориентируется urlresolver. Это обеспечивает схему url-адресов сайта

#### Изменение настроек

Внесем изменения в файл `django_blog/settings.py`. Для редактирования файла, нажмите на него ПКМ и выберите пункт "Edit with IDLE". 

В файле `settings.py` нужно найти строку `TIME_ZONE` и внести изменения в соответствии со своим часовым поясом:

`TIME_ZONE = 'Europe/Moscow'`

Аналогично с язоковыми настройками:

`LANGUAGE_CODE = 'ru-ru'`

Также необходимо добавить в настройки информацию о расположении статических файлов (Картинки, файлы с кодом CSS для создания стилей). Спуститесь в конец файла и после переменной STATIC_URL добавьте новую — STATIC_ROOT:

```
STATIC_URL = '/static/'
STATIC_ROOT = os.path.join(BASE_DIR, 'static')
```

TODO: Добавить про ALLOWED_HOSTS

#### Настройка Базы Данных

Существует множество различных баз данных, которые могут хранить данные для сайта. Мы будем использовать стандартную — sqlite3.

Она уже выбрана по умолчанию в файле `django_blog/settings.py`:

```
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.sqlite3',
        'NAME': os.path.join(BASE_DIR, 'db.sqlite3'),
    }
}
```

Для создания базы данных нужно запустить команду `python manage.py migrate` (необходимо находится в директории django_blog, где расположен файл `manage.py`). 

#### Запуск веб-сервера

После успешного создания базы данных можно перейти к запуску веб-сервера, чтобы удостовериться в работоспособности созданного проекта. 

> Веб-сервер - сервер, принимающий HTTP-запросы от клиентов, обычно веб-браузеров, и выдающий им HTTP-ответы, как правило, вместе с HTML-страницей, изображением, файлом, медиа-потоком или другими данными.

Для запуска веб-сервера необходимо находится в директории django_blog, в которой находится файл `manage.py`. 

Выполним команду `python manage.py runserver`.
> В случае возникновения ошибки UnicodeDecodeError используйте команду `python manage.py runserver 0:8000`

После этого откроем браузер, и введем следующий адрес `http://127.0.0.1:8000/`. В случае успеха появится приветсвенное письмо.

![hello_screen](https://github.com/Study-Projects/database_tutorial/blob/master/img/it_worked2.png)

Во время работы веб-сервера консоль будет недоступна для ввода команд. Чтобы иметь такую возможность, нужно открыть еще одно окно терминала, активировать виртуальное окружение и перейти в домашнюю директорию проекта, содержащую файл `manage.py`.


## Глава 3. Модели Django. (Илья)


## Глава 4. Администрирование БД.

Для управления содержимым созданной нами базы данных, ее моделей Django предоставляет удобный интерфейс администратора.

Прежде всего нужно создать учетную запись администратора. Для этого в консоли выполните команду `python manage.py createsuperuser`. Введите необходимые данные, нажмите Enter.

Откроем файл `blog/admin.py` и заменим его содержимое на:

```python3
from django.contrib import admin
from .models import Post

admin.site.register(Post)
```

Данный код позволит отобразить модель `Post` на страницк администратора.

В браузере перейдем по адресу `http://127.0.0.1:8000/admin/`. После авторизации вы увидите панель управления приложениямии и, содержащихся в них, моделями. Перейдите в раздел Post и выполните несколько действий для ознакомления с возможностями интерфейса админа. 


## Глава 5. Публикация. (Илья)

https://tutorial.djangogirls.org/ru/deploy/

## Глава 6. URL-адреса (Илья)

https://tutorial.djangogirls.org/ru/django_urls/


## Глава 7. Django ORM, предстваления и динамические данные. 

Для работы с базами данных может использоваться несколько подходов. В случае с Django взаимодействие с БД происходит через ORM (Object-Relational Mapping) - технологии программирования, которая связывает базы данных с концепциями объектно-ориентированных языков программирования, создавая «виртуальную объектную базу данных». (Википедия)

Задача ORM - обеспечить работу с данными в терминах классов, а не таблиц данных и напротив, преобразовать термины и данные классов в данные, пригодные для хранения в СУБД. Необходимо также обеспечить интерфейс для CRUD-операций над данными. В общем, необходимо избавиться от необходимости писать SQL-код для взаимодействия в СУБД.

Это краткое описание, за подробностями можно обратиться к пособию по ORM (TODO: ссыль на Пашину методичку)

Для отображения данных содержащихся в БД пользователю в Django используются представления (views). Их задача - соединять между собой модели и шаблоны - мы определяем, что (какая модель) будет отображена в шаблоне. По сути - это обычные функции, в которых происходит обработка данных.

Откроем файл `blog/views.py` и вставим следующий код: 

```
from django.shortcuts import render
from django.utils import timezone
from .models import Post

def post_list(request):
    posts = Post.objects.filter(published_date__lte=timezone.now()).order_by('published_date')
    return render(request, 'blog/post_list.html', {'posts': posts})
```

Что здесь происходит? В начале импортируется функция `render`, которая отправляет данные в файл с HTML-разметкой, которая будет отображаться на экране браузера (шаблоны будут созданы в следующей главе). Также импортируется функция `timezone` для определения времени публикации поста и модель Post, для получения данных о постах из БД. 

В представлении `post_list` мы получаем список всех постов, находящихся в БД, отсортированных по дате публикации. Далее мы передаем в HTML-файл переменную содержащую все посты и имя самого HTML-файла. Переменная request служит передатчиком информации о запросе клиента к серверу и ответа сервера клиенту. Это относится к основам работы HTTP протокола передачи данных. [Подробнее тут](https://ru.wikipedia.org/wiki/HTTP).

Таким образом принцип работы предстваления сводится к:
- Получению запроса от клиента;
- Проведение манипуляций с данными полученными от клиента (выбор данных из БД, обработка данных, поступивших в запросе и т.д.
- Передача полученных данных в шаблон и их отбражение на странице пользователя. 



## Глава 8. Шаблоны. (Артём)

https://tutorial.djangogirls.org/ru/extend_your_application/

Шаблон — это файл, который можено использовать повторно для отображения различной информации в заданном формате. Шаблоны в Django написаны на языке, называемом HTML - гипертекстовой разметки. Гипертекст — это тип текста, поддерживающий гиперссылки между страницами. Под разметкой понимается введение в текст документа кода, который будет говорить браузеру (в нашем случае), как интерпретировать веб-страницу. HTML код строится при помощи тегов, каждый из которых должен начинаться с `<` и заканчиваться `>`. Эти теги представляют элементы разметки.

>В этом пособии не будет объяснения по HTML, вместо этого вам будет предложен готовый код. За подробностями можно обратиться в Гугл. На просторах Интернета множество курсов по HTML.

Код на HTML статичен - это значит он не может изменятся без прямого переписывания содержимого тегов. Также браузер не воспринимает других языков, помимо HTML. Это нам не подходит, так как мы хотим, чтобы страница отоброжала ту информацию, которую запросит пользователь и при этом избежать штампования большого количества html-файлов, различающихся только текстом в тегах.

Для решения этой проблемы существуют *теги шаблонов Django*. Теги шаблонов Django позволяют вставлять Python в HTML, давая возможность создавать динамические веб-сайты быстрее и проще. 

В предыдущей главе предстваление `post_list` передавало шаблону список постов в переменной `posts`. Пришло время отобразить это. 

Создадим шаблон `blog/templates/blog/post_list.html`. 
Чтобы вставить переменную в шаблон Django, нам нужно использовать двойные фигурные скобки с именем переменной внутри:
`{{ posts }}`.

Если просто вставить переменную в шаблон мы увидим строку подобного вида: `<QuerySet [<Post: My second post>, <Post: My first post>]>`.
Так Django отображает содержимое БД. `QuerySet` означает, что объект, живущий в переменной - итерируемый. Это значит, что мы можем применить к нему цикл `for` и вывести поэлементно его содержимое (привет началам программирования).

Однако прежде, чем писать код, давайте задумаемся. Мы знаем как располагать теги для красивого оформления (если нет - гугл в помощь). Мы также знаем, как динамически отображать данные полученные нами из БД. Однако есть один момент - при таком подоходе, все шаблоны будут иметь 80% одинакового содержимого. Стили и цвета шапки и футера, цветовая гамма, позиционирование базовых блоков - все это будет повторяться из шаблона в шаблон. Чтобы избежать этого, в Django предусмотрен механизм расширения шаблонов. 

#### Создаем базовый шаблон

Базовый шаблон — это наиболее общая типовая форма страницы, которую можно расширять для отдельных случев. 
Создадим файл `base.html` в директории `blog/templates/blog/`. Получим такую структуру: 

```
blog
└───templates
    └───blog
            base.html
            post_list.html
```

Откройте файл `base.html` и вставьте в него:

```
{% load staticfiles %}
<html>
    <head>
        <title>Django blog</title>
        <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
        <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css">
        <link href='//fonts.googleapis.com/css?family=Lobster&subset=latin,latin-ext' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="{% static 'css/blog.css' %}">
    </head>
    <body>
        <div class="page-header">
            <h1><a href="/">Django Girls Blog</a></h1>
        </div>
        <div class="content container">
            <div class="row">
                <div class="col-md-8">
                {% block content %}
                {% endblock %}
                </div>
            </div>
        </div>
    </body>
</html>
```
То что находится в `{}` - теги Django. Конструкция `{{ var_name }}` используется для отображения содержимого переменной. 
Конструкция `{% some_instruction %}` используется для применения возможностей языка тегов.

Тег `{% block content %} {% endblock %}` будет включать в себя содержимое той или иной веб-страницы. 

Таким образом мы создали базовый шаблон, в котором будет прописана статичная информация, не меняющаяся от одной страницы сайта к другой. А всю динамически изменяющуюся информацию мы вынесем в отдельные файлы и заключим их содержимое в блок `{% block content %} {% endblock %}`, для того чтобы обеспечить соединение `base` шаблона,с основными стилями, и обычного, с его информацией. 

Перейем в файо `post_list.html` и вставим в него следующий код:

```
{% extends 'blog/base.html' %}

{% block content %}
    {% for post in posts %}
        <div class="post">
            <div class="date">
                {{ post.published_date }}
            </div>
            <h1><a href="">{{ post.title }}</a></h1>
            <p>{{ post.text|linebreaksbr }}</p>
        </div>
    {% endfor %}
{% endblock %}
```

Команда `{% extends 'blog/base.html' %}` обеспечивает наследование стилей и информации из `base` шаблона в нужный нам шаблон. `{% block content %} {% endblock %}` включает в себя информацию, необходимую для отображения. Конструкция `{% for post in posts %} {% endfor %}` обеспечивает перебор содержимого переменной `{{ posts }}` и выводит его на страницу, обращаясь в каждой строке к соответсвующим полям таблицы Post, как например `{{ post.title }}` (Подробнее об этом было рассказано в главе Модели Django).

Теперь можно посмотреть, как информация отбражается в браузере.

> Если появилась ошибка TemplateDoesNotExists, это значит, что нет файла blog/base.html и runserver запущен в командной строке. Попробуйте остановить его (`Ctrl-C`) и перезапустите веб-сервер командой `python manage.py runserver`.


## Глава 9. Формы. (Илья)
https://tutorial.djangogirls.org/ru/django_forms/
